<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Good Morning Newsletter</title> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Reset & Base Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            width: 100% !important; 
            margin: 0 !important; 
            padding: 10px !important; 
            -webkit-text-size-adjust: 100%; 
            -ms-text-size-adjust: 100%; 
            background-color: #efcfe3; 
            font-family: 'Merriweather', serif;
            line-height: 1.5;
            color: #444;
        }
        
        img { 
            max-width: 100%;
            height: auto;
            display: block;
            border: 0;
        }
        
        /* Bento Grid Container */
        .bento-container {
            max-width: 700px;
            margin: 0 auto;
            background-color: #fff;
            border: 2px solid #e27396;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(226, 115, 150, 0.15);
            overflow: hidden;
            padding: 8px;
        }
        
        /* True Bento Grid System */
        .bento-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            width: 100%;
        }
        
        .bento-col {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .bento-col-60 {
            flex: 60;
        }
        
        .bento-col-40 {
            flex: 40;
        }
        
        /* Bento Grid Items */
        .bento-item {
            background-color: #FFFFFF;
            border-radius: 6px;
            padding: 15px;
            border: 1px solid rgba(226, 115, 150, 0.5);
            overflow: hidden;
            height: 100%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        /* Cell Themes - Using provided color scheme */
        .cell-pink { background-color: #e27396; border-color: #e27396; color: #fff; } /* Dark Pink */
        .cell-lightpink { background-color: #ea9ab2; border-color: #e27396; color: #fff; } /* Light Pink */
        .cell-soft { background-color: #efcfe3; border-color: #ea9ab2; } /* Soft Pink */
        .cell-green { background-color: #eaf2d7; border-color: #eaf2d7; } /* Light Green */
        .cell-blue { background-color: #b3dee2; border-color: #b3dee2; } /* Light Blue */
        
        /* Headers */
        h1, h2, .item-title { 
            font-family: 'Oswald', sans-serif; 
            font-weight: 700; 
            margin-bottom: 10px;
            line-height: 1.2;
            text-align: center;
        }
        
        .cell-pink h1, .cell-pink h2, .cell-lightpink h1, .cell-lightpink h2 {
            color: #fff;
        }
        
        .cell-soft h1, .cell-soft h2, .cell-green h1, .cell-green h2, .cell-blue h1, .cell-blue h2 {
            color: #e27396;
        }
        
        h1 { 
            font-size: 22px; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.4); 
            padding-bottom: 6px; 
            margin-bottom: 8px;
        }
        
        .cell-soft h1, .cell-green h1, .cell-blue h1 {
            border-bottom: 1px solid rgba(226, 115, 150, 0.4);
        }
        
        h2 { 
            font-size: 16px; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.3); 
            padding-bottom: 4px; 
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cell-soft h2, .cell-green h2, .cell-blue h2 {
            border-bottom: 1px solid rgba(226, 115, 150, 0.3);
        }
        
        h2 .icon {
            margin-right: 6px;
        }
        
        /* Typography */
        p { margin: 0 0 8px 0; }
        p:last-child { margin-bottom: 0; }
        
        .text-center { text-align: center; }
        
        .header-subtitle {
            font-size: 12px;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .header-quote {
            font-style: italic;
            font-size: 14px;
            margin: 10px auto 0;
            text-align: center;
            max-width: 95%;
        }
        
        .header-quote cite {
            display: block;
            text-align: right;
            font-size: 12px;
            font-style: normal;
            margin-top: 4px;
        }
        
        .text-sm { font-size: 13px; }
        .text-xs { font-size: 12px; line-height: 1.4; }
        .text-xxs { font-size: 11px; line-height: 1.3; }
        .light-text { color: rgba(255, 255, 255, 0.8); }
        
        .cell-soft .light-text, .cell-green .light-text, .cell-blue .light-text {
            color: rgba(226, 115, 150, 0.7);
        }
        
        /* Solar */
        .solar-info {
            font-size: 13px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .solar-info strong {
            display: inline-flex;
            align-items: center;
            width: 140px;
        }
        
        .solar-info strong .emoji {
            margin-right: 5px;
        }
        
        .solar-info span {
            text-align: right;
            flex-grow: 1;
        }
        
        /* Word of Day */
        .wod-word {
            font-family: 'Oswald', sans-serif;
            font-size: 16px;
            color: #e27396;
            text-transform: uppercase;
            display: block;
            margin-bottom: 2px;
            text-align: center;
        }
        
        .cell-pink .wod-word, .cell-lightpink .wod-word {
            color: #fff;
        }
        
        .wod-pos {
            text-align: center;
            display: block;
            margin-bottom: 6px;
            font-size: 11px;
        }
        
        /* Scrollable Containers */
        .scroll-container {
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #ea9ab2 #efcfe3;
            max-height: 150px;
            margin-bottom: 5px;
            padding-right: 5px;
        }
        
        /* Modified: Recipe scroll container is taller */
        .recipe-scroll-container {
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #ea9ab2 #efcfe3;
            max-height: 220px;
            margin-bottom: 10px;
            padding-right: 5px;
        }
        
        .scroll-container::-webkit-scrollbar,
        .recipe-scroll-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .scroll-container::-webkit-scrollbar-track,
        .recipe-scroll-container::-webkit-scrollbar-track {
            background: #efcfe3;
            border-radius: 3px;
        }
        
        .scroll-container::-webkit-scrollbar-thumb,
        .recipe-scroll-container::-webkit-scrollbar-thumb {
            background-color: #ea9ab2;
            border-radius: 3px;
        }
        
        /* Recipe */
        .recipe-image-container {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .recipe-image {
            max-width: 90%;
            height: auto;
            margin: 0 auto;
            border: 1px solid #ea9ab2;
            border-radius: 4px;
        }
        
        .recipe-list {
            font-size: 11px;
            line-height: 1.3;
            padding-left: 18px;
            margin: 8px 0;
        }
        
        .recipe-list li {
            margin-bottom: 5px;
        }
        
        .recipe-source-link {
            display: block;
            text-align: center;
            font-size: 11px;
            margin-top: 8px;
        }
        
        /* Research Papers */
        .paper-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        
        .paper-item {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed rgba(226, 115, 150, 0.2);
        }
        
        .paper-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .paper-title {
            font-weight: bold;
            font-size: 13px;
            margin-bottom: 3px;
            color: #e27396;
            display: block;
        }
        
        .cell-pink .paper-title, .cell-lightpink .paper-title {
            color: #fff;
        }
        
        .paper-abstract {
            font-size: 12px;
            margin-bottom: 3px;
            line-height: 1.4;
        }
        
        .paper-meta {
            font-size: 10px;
        }
        
        /* Restaurant List - Modified for new layout */
        .resto-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        
        .resto-item {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px dashed rgba(226, 115, 150, 0.2);
        }
        
        .resto-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .resto-photo-container {
            text-align: center;
            margin: 8px 0;
        }
        
        .resto-photo {
            width: 120px;
            height: 120px;
            border-radius: 4px;
            object-fit: cover;
            border: 1px solid #ea9ab2;
            margin: 0 auto;
        }
        
        .resto-details {
            width: 100%;
        }
        
        .resto-name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 2px;
            display: block;
            color: #e27396;
            text-align: center;
        }
        
        .cell-pink .resto-name, .cell-lightpink .resto-name {
            color: #fff;
        }
        
        .resto-address {
            font-size: 11px;
            line-height: 1.3;
            margin: 5px 0 8px;
            text-align: center;
            font-style: italic;
        }
        
        .cell-pink .resto-address, .cell-lightpink .resto-address {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .cell-soft .resto-address, .cell-green .resto-address, .cell-blue .resto-address {
            color: rgba(226, 115, 150, 0.7);
        }
        
        .resto-rating-line {
            font-size: 11px;
            line-height: 1.2;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .resto-rating-stars {
            color: #e27396;
            margin-right: 3px;
            display: inline-flex;
        }
        
        .cell-pink .resto-rating-stars, .cell-lightpink .resto-rating-stars {
            color: #ffdb58;
        }
        
        /* Reviews */
        .resto-reviews h4 {
            font-family: 'Oswald', sans-serif;
            font-weight: 400;
            font-size: 12px;
            color: #e27396;
            margin: 6px 0 4px;
            padding-top: 4px;
            border-top: 1px dotted rgba(226, 115, 150, 0.2);
            text-transform: uppercase;
        }
        
        .cell-pink .resto-reviews h4, .cell-lightpink .resto-reviews h4 {
            color: #fff;
            border-top: 1px dotted rgba(255, 255, 255, 0.3);
        }
        
        .resto-reviews ul {
            list-style: none;
            margin: 0;
            padding: 0;
            font-size: 11px;
        }
        
        .resto-reviews li {
            margin-bottom: 4px;
        }
        
        .reviewer-line {
            margin-bottom: 2px;
            display: flex;
            align-items: center;
        }
        
        .reviewer {
            font-weight: bold;
        }
        
        .review-stars {
            color: #e27396;
            margin-left: 4px;
            display: inline-flex;
        }
        
        .cell-pink .review-stars, .cell-lightpink .review-stars {
            color: #ffdb58;
        }
        
        .review-text {
            font-style: italic;
            color: #555;
            display: block;
        }
        
        .cell-pink .review-text, .cell-lightpink .review-text {
            color: rgba(255, 255, 255, 0.9);
        }
        
        /* Cat Image */
        .cat-image-container {
            text-align: center;
            margin-top: 5px;
        }
        
        .cat-image {
            width: 100%;
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            border: 1px solid #ea9ab2;
        }
        
        /* Video Recipe Link - New style */
        .video-recipe-link {
            display: block;
            text-align: center;
            margin-top: 8px;
            font-size: 12px;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Fix for star ratings horizontal display */
        .stars-container {
            display: inline-flex;
            white-space: nowrap;
            align-items: center;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 15px 10px 10px;
            border-top: 2px solid #ea9ab2;
            color: #e27396;
            font-size: 12px;
            width: 100%;
        }
        
        a {
            color: #e27396;
            text-decoration: none;
        }
        
        .cell-pink a, .cell-lightpink a {
            color: #fff;
            text-decoration: underline;
        }
        
        /* Media Queries for Responsive Bento Grid */
        @media screen and (max-width: 650px) {
            .bento-row {
                flex-direction: column;
            }
            
            .bento-col {
                width: 100%;
            }
            
            .bento-col-60, .bento-col-40 {
                flex: 1;
            }
            
            .bento-item {
                width: 100%;
            }
            
            h1 {
                font-size: 20px;
            }
            
            h2 {
                font-size: 15px;
            }
            
            .scroll-container {
                max-height: 180px;
            }
            
            .recipe-scroll-container {
                max-height: 250px;
            }
            
            .paper-list, .recipe-list, .resto-list {
                font-size: 12px;
            }
        }
    </style>
</head>

<body bgcolor="#efcfe3" style="background-color: #efcfe3;">
    <!-- Bento Grid Container -->
    <div class="bento-container">
        <!-- Row 1: "Good Morning" header & quote (60%) | Solar Schedule & Cat GIF stacked (40%) -->
        <div class="bento-row">
            <!-- Good Morning Header Column (60%) -->
            <div class="bento-col bento-col-40">
                <div class="bento-item cell-lightpink">
                    <h2>Good Morning, Zack!!!</h2>
                    <p class="header-subtitle">{{ datetime }}</p>
                    <p class="header-quote">
                        <em>{{ zen_quote.quote }}</em>
                        <cite>— {{ zen_quote.author }}</cite>
                    </p>
                </div>
            </div>
            
            <!-- Solar & Cat Column (40%) with proper stacking -->
            <div class="bento-col bento-col-60">
                <!-- Solar Schedule - First item -->
                <div class="bento-item cell-blue">
                    <h2><span class="icon">☀️</span> Today's Solar Schedule</h2>
                    <div class="solar-info">
                        <strong><span class="emoji">🌅</span> Sunrise:</strong> 
                        <span>{{ solar_schedule.sunrise }}</span>
                    </div>
                    <div class="solar-info">
                        <strong><span class="emoji">🌇</span> Sunset:</strong> 
                        <span>{{ solar_schedule.sunset }}</span>
                    </div>
                    <div class="solar-info">
                        <strong><span class="emoji">✨</span> Golden time:</strong> 
                        <span>{{ solar_schedule.golden_hour }}</span>
                    </div>
                </div>
                
                <!-- Daily Cat - Below Solar Schedule -->
                <div class="bento-item cell-soft">
                    <h2><span class="icon">🐾</span> Today's Cute Cat</h2>
                    <div class="cat-image-container">
                        <img src="{{ cat_gif }}" alt="Cat of the day" class="cat-image">
                    </div>
                    <p style="font-size: 12px; font-style: italic; text-align: center; margin-top: 8px;">meow meow meow</p>
                </div>
            </div>
        </div>
        
        <!-- Row 2: Research papers (60%) | Word of the Day, Fact, Horoscope stacked (40%) -->
        <div class="bento-row">
            <!-- Research Papers Column (60%) -->
            <div class="bento-col bento-col-60">
                <div class="bento-item cell-green">
                    <h2><span class="icon">🔭</span> Research papers on: {{ arxiv_query | capitalize }}</h2>
                    
                    {% if arxiv_papers %}
                    <ul class="paper-list">
                        {% for paper in arxiv_papers[:3] %}
                        <li class="paper-item">
                            <span class="paper-title">{{ paper.title }}</span>
                            <div class="scroll-container">
                                <p class="paper-abstract">{{ paper.abstract }}</p>
                            </div>
                            <p class="paper-meta">
                                <span class="light-text">{{ paper.published }}</span> | 
                                <a href="{{ paper.pdf_link }}" target="_blank">PDF</a>
                            </p>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="light-text text-center">No new papers found for "{{ arxiv_query }}".</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Word, Fact, Horoscope Column (40%) - Properly stacked vertically -->
            <div class="bento-col bento-col-40">
                <!-- Word of the Day -->
                <div class="bento-item cell-pink">
                    <h2><span class="icon">📖</span> Word of the Day</h2>
                    <strong class="wod-word">{{ wod.word }}</strong>
                    <span class="wod-pos light-text">({{ wod.part_of_speech }})</span>
                    <p class="text-sm">{{ wod.definition }}</p>
                </div>
                
                <!-- Interesting Fact -->
                <div class="bento-item cell-blue">
                    <h2><span class="icon">💡</span> Today's Interesting Fact</h2>
                    <p class="text-sm">{{ interesting_fact }}</p>
                </div>
                
                <!-- Horoscope -->
                <div class="bento-item cell-soft">
                    <h2><span class="icon">✨</span> Horoscope Prediction</h2>
                    <p class="text-xs">{{ horoscope.prediction }}</p>
                    <p class="light-text text-xxs text-center">{{ horoscope.date }}</p>
                </div>
            </div>
        </div>
        
        <!-- Row 3: Recipe (40%) | Nearby restaurants (60%) - Fixed height matching -->
        <div class="bento-row">
            <!-- Recipe Column (40%) - Modified with taller scroll container -->
            <div class="bento-col bento-col-40">
                <div class="bento-item cell-lightpink">
                    <h2><span class="icon">🍳</span> Recipe of the Day</h2>
                    <p class="text-center text-sm"><strong>{{ recipe.name }}</strong></p>
                    
                    <a href="{{ recipe.image_url or '#' }}" target="_blank" class="recipe-image-container">
                        {% if recipe.image_url %}
                        <img src="{{ recipe.image_url }}" alt="Image of {{ recipe.name }}" class="recipe-image">
                        {% endif %}
                    </a>
                    
                    <!-- Modified: Using taller recipe-scroll-container -->
                    <div class="recipe-scroll-container">
                        <ol class="recipe-list">
                            {% set instructions_list = recipe.instructions.splitlines() %}
                            {% for instruction in instructions_list %}
                                {% if instruction.strip() %}<li>{{ instruction.strip() }}</li>{% endif %}
                            {% endfor %}
                        </ol>
                    </div>
                    
                    <!-- Added: Video recipe link at the bottom -->
                    {% if recipe.youtube_url %}
                    <a href="{{ recipe.youtube_url }}" target="_blank" class="video-recipe-link">Click here to view the video recipe</a>
                    {% endif %}
                    
                </div>
            </div>
            
            <!-- Restaurants Column (60%) - Redesigned layout as requested -->
            <div class="bento-col bento-col-60">
                <div class="bento-item cell-green">
                    <h2><span class="icon">🍜</span> Restaurants that serve {{ text_query }}</h2>
                    
                    {% if places %}
                    <ul class="resto-list">
                        {% for place in places[:3] %}
                        <li class="resto-item">
                            <!-- Place name and ratings header -->
                            <span class="resto-name">{{ place.name }}</span>
                            <div class="resto-rating-line">
                                <div class="stars-container">
                                    {% set r = place.rating|default(0)|round|int %}
                                    {% for i in range(r) %}⭐{% endfor %}
                                    {% if r < 5 %}
                                        {% for i in range(5-r) %}<span style="opacity: 0.3;">⭐</span>{% endfor %}
                                    {% endif %}
                                </div>
                                <span class="light-text">&nbsp;({{ place.rating|round(1) if place.rating else 'N/A' }}) {{ place.user_ratings_total or '?' }} ratings</span>
                            </div>
                            
                            <!-- Centered image -->
                            <div class="resto-photo-container">
                                <img src="{% if place.photo_base64 %}data:image/jpeg;base64,{{ place.photo_base64 }}{% else %}https://via.placeholder.com/60x60.png?text=IMG{% endif %}" alt="" class="resto-photo">
                            </div>
                            
                            <!-- Address in small italics -->
                            <p class="resto-address">{{ place.address }}</p>

                            <!-- Address in small italics -->
                            {% if place.google_map_link %}
                            <p class="resto-address">
                                <a href="{{ place.google_map_link }}" target="_blank" rel="noopener noreferrer">Google Maps Link</a>
                            </p>
                            {% endif %}
                            
                            <!-- Scrollable reviews at the bottom -->
                            {% if place.reviews %}
                            <div class="resto-reviews">
                                <h4>Reviews:</h4>
                                <div class="scroll-container">
                                    <ul>
                                        {% for review in place.reviews %}
                                        <li>
                                            <div class="reviewer-line">
                                                <span class="reviewer">{{ review.reviewer_name or 'Anon' }}:</span>
                                                <div class="review-stars">
                                                    {% set rr = review.rating|default(0)|round|int %}
                                                    {% for i in range(rr) %}⭐{% endfor %}
                                                    {% if rr < 5 %}
                                                        {% for i in range(5-rr) %}<span style="opacity: 0.3;">⭐</span>{% endfor %}
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <span class="review-text">"{{ review.text }}"</span>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="light-text text-center">No matching places found nearby.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="bento-row">
            <div class="footer">
                <p>Have a wonderful day!</p>
            </div>
        </div>
    </div>
</body>
</html>