<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Good Morning {{ recipient_name }}! - {{ date }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --journal-bg: #f5f5dc; /* Beige */
            --body-bg-fallback: #d2b48c; /* Tan */
            --header-color: #5d4037; /* Dark Brown */
            --text-color: #4e342e; /* Brown Text */
            --accent-green: #388e3c; /* Green */
            --accent-gold: #b8860b; /* DarkGoldenrod */
            --accent-steel: #78909c; /* Blue Grey */
            --light-text: #8d6e63; /* Brownish Grey */
            --border-color: #795548; /* Brown */
            /* --content-block-bg: #ffffff; Removed */
            --table-cell-bg: #fafafa; /* Off-white */
        }

        body {
            font-family: 'Merriweather', serif;
            line-height: 1.6;
            color: var(--text-color);
            margin: 0;
            padding: 0;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }

        .email-wrapper-cell { padding: 10px; }

        .container {
            max-width: 700px;
            background-color: var(--journal-bg);
            border: 2px solid var(--border-color);
            border-radius: 4px;
            margin: 15px auto;
            padding: 20px 25px 30px 25px;
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
        }

        /* Header Block Styling */
        .header-block {
             padding: 15px;
             margin-bottom: 25px;
             border-radius: 4px;
             border: 1px solid #ddd; /* Subtle border */
        }
        header { text-align: center; margin: 0; border-bottom: none; padding-bottom: 0; } /* Simplified header */
        h1 { font-family: 'Oswald', sans-serif; font-size: 28px; color: var(--header-color); margin: 0 0 8px 0; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        header .subtitle { font-size: 14px; color: var(--light-text); margin-bottom: 12px; }
        header .zen-quote { font-size: 16px; font-style: italic; color: var(--text-color); margin: 0 auto; max-width: 90%; }
        header .zen-quote span { display: block; text-align: right; font-size: 14px; color: var(--light-text); margin-top: 5px; }

        /* Section Styling - Now includes background inline */
        .section {
            margin-bottom: 25px;
            padding: 15px 18px; /* Padding for content */
            border-radius: 4px;
            border: 1px solid #ccc; /* Default border */
            /* background-color applied inline */
        }
        /* Removed :first-of-type border rule, border applied inline or above */
        /* Remove dashed border-top as sections have full borders now */
        .section { border-top: none; }


        h2 {
            font-family: 'Oswald', sans-serif; font-weight: 700; font-size: 19px;
            color: var(--accent-green); margin: 0 0 15px 0; padding-bottom: 5px;
            border-bottom: 2px solid var(--border-color); /* Keep header underline */
            display: flex; align-items: center; text-transform: uppercase;
        }
        h2 .icon { margin-right: 10px; font-size: 1.1em; color: var(--accent-green);}

        /* Content block class - only used where specific inner styling needed beyond section bg */
        .content-block {
            /* Only keep styles NOT related to background/border/padding if needed */
            margin-top: 10px;
        }

        /* Solar Schedule */
        .solar-grid { text-align: center; margin-top: 10px; font-size: 0; }
        .solar-item {
            display: inline-block; width: 95px; /* Increased width slightly */
            background-color: #ffffff; padding: 8px 4px;
            border-radius: 4px; border: 1px solid var(--accent-green);
            text-align: center; vertical-align: top;
            margin: 5px; font-size: 12px;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        /* Increased image size */
        .solar-item img { display: block; width: 120px; height: 120px; margin: 0 auto 8px auto; border-radius: 3px; background-color: #fff; object-fit: cover; }
        .solar-item strong { display: block; font-size: 10px; color: var(--header-color); font-weight: bold; margin-bottom: 4px; text-transform: uppercase; }
        .solar-item span { font-weight: bold; font-size: 14px; color: var(--accent-green); }

        /* Fact Block */
        .fact-block p { font-size: 15px; margin: 0; }

        /* Word of the Day Block */
        .wod-block .word { font-size: 24px; font-family: 'Oswald', sans-serif; font-weight: 700; color: var(--header-color); display: block; margin-bottom: 5px; text-transform: uppercase; }
        .wod-block .pos { font-style: italic; color: var(--light-text); margin-bottom: 10px; display: block; font-size: 14px;}
        .wod-block .definition { font-size: 15px; }

        /* Recipe Block */
        .recipe-name { font-family: 'Oswald', sans-serif; font-size: 18px; font-weight: 700; color: var(--header-color); text-align: center; margin-bottom: 15px; }
        .recipe-block img { display: block; max-width: 80%; height: auto; margin: 0 auto 20px auto; border: 2px solid var(--border-color); border-radius: 4px; }
        .recipe-block .instructions { margin-top: 15px; }
        .recipe-block h3 { font-size: 16px; color: var(--header-color); margin-bottom: 8px; font-weight: bold; font-family: 'Oswald', sans-serif; }
        .recipe-block ol { padding-left: 25px; margin: 0; font-size: 14px; }
        .recipe-block li { margin-bottom: 8px; }

        /* Restaurant Section */
        /* Restaurant wrapper no longer needed for background */
        .restaurant-table { width: 100%; border-collapse: separate; border-spacing: 0 12px; margin-top: 10px; }
        .restaurant-table td { padding: 12px 15px; vertical-align: top; background-color: var(--table-cell-bg); border: 1px solid #ccc; border-radius: 5px; }
        .restaurant-photo-cell { width: 110px; padding: 12px 15px 12px 12px; text-align: center; }
        .restaurant-photo { display: block; width: 100px; height: auto; border: 1px solid var(--border-color); border-radius: 4px; background-color: #eee; margin: 0 auto; }
        .restaurant-details h3 { font-size: 17px; margin: 0 0 5px 0; color: var(--header-color); font-family: 'Oswald', sans-serif; font-weight: 700; text-transform: uppercase;}
        .restaurant-details .address { font-size: 12px; color: var(--light-text); margin-bottom: 8px; }
        .restaurant-details .rating { font-size: 13px; color: var(--light-text); margin-bottom: 10px; }
        .restaurant-details .rating .stars { color: var(--accent-gold); font-size: 1.2em; letter-spacing: 1px;}
        .restaurant-details h4 { font-size: 14px; margin: 10px 0 5px 0; color: var(--accent-green); font-weight: bold; text-transform: uppercase; font-family: 'Oswald', sans-serif; letter-spacing: 0.5px;}
        .restaurant-details ul { list-style: none; padding: 0; margin: 0; font-size: 13px; }
        .restaurant-details li { margin-bottom: 8px; background-color: #fff; padding: 8px 10px; border-radius: 3px; border: 1px solid #eee;}
        /* Reviewer name and stars on the same line */
        .restaurant-details li .reviewer-line { margin-bottom: 3px; display: block; } /* Container for name+stars */
        .restaurant-details li .reviewer { font-weight: bold; color: var(--text-color); font-size: 0.95em; display: inline-block; /* Make inline */ }
        .restaurant-details li .review-rating { display: inline-block; margin-left: 8px; color: var(--accent-gold); font-size: 0.9em;}
        .restaurant-details li .review-text { color: #555; display: block; } /* Keep text block */

        /* ArXiv Section */
        /* Arxiv wrapper no longer needed for background */
        .arxiv-query-display { font-style: italic; color: var(--light-text); font-size: 14px; margin-bottom: 10px; display: block;} /* Ensure it's block */
        .arxiv-item { background-color: #ffffff; border: 1px solid #e0e0e0; border-radius: 4px; padding: 12px 15px; margin-bottom: 12px; }
        .arxiv-label { font-weight: bold; color: var(--accent-steel); font-size: 0.9em; }
        .arxiv-title { font-weight: bold; color: var(--text-color); font-size: 16px; margin-bottom: 5px; }
        .arxiv-abstract { font-size: 14px; margin-bottom: 8px; line-height: 1.5; }
        .arxiv-meta { font-size: 12px; color: var(--light-text); margin-top: 5px;}
        .arxiv-link { font-size: 12px; word-break: break-all; margin-top: 5px; }
        .arxiv-link a { color: var(--accent-green); text-decoration: none; font-weight: bold; }
        .arxiv-link a:hover { text-decoration: underline; }

        /* Horoscope Block */
        .horoscope-block .sign { font-weight: bold; font-size: 18px; font-family: 'Oswald', sans-serif; color: var(--accent-steel); text-transform: uppercase; display: block; margin-bottom: 5px; }
        .horoscope-block p { font-size: 15px; margin: 0; }
        .horoscope-block .date { font-size: 0.9em; color: var(--light-text); margin-top: 8px; display: block; font-style: italic; }

        /* Cat GIF Block */
        .cat-gif-block img { display: block; max-width: 85%; height: auto; margin: 0 auto; border: 2px solid var(--border-color); border-radius: 4px; }

        /* Footer */
        .footer { text-align: center; margin-top: 30px; padding-top: 15px; border-top: 1px solid var(--border-color); color: var(--light-text); font-size: 12px; }

        /* Responsive Adjustments */
        @media (max-width: 650px) {
            .email-wrapper-cell { padding: 5px; }
            .container { padding: 10px 15px 15px 15px; }
            h1 { font-size: 22px; }
            h2 { font-size: 17px; }
            /* Update section padding for mobile */
            .section, .header-block { padding: 12px; }
            header .zen-quote { font-size: 15px; }
            .solar-item { width: calc(33% - 12px); }
            .solar-item img { width: 35px; height: 35px; } /* Adjusted size */
            .restaurant-table { padding: 0; border-spacing: 0; }
            .restaurant-table td { padding: 10px 8px; display: block; width: auto !important; border-radius: 0; border: none; background: none; }
            .restaurant-table tr { display: block; margin-bottom: 15px; background-color: var(--table-cell-bg); border: 1px solid #ccc; border-radius: 5px; padding: 10px;}
            .restaurant-photo-cell { text-align: center; padding: 0 0 10px 0;}
            .restaurant-photo { width: 130px; }
            .arxiv-abstract { font-size: 13px; }
            .arxiv-item { padding: 10px; }
        }

    </style>
</head>
<body bgcolor="#d2b48c" background="https://i.pinimg.com/736x/69/d3/4f/69d34fab8f7d9d13a934296b29509630.jpg" style="background-color: #d2b48c; background-image: url('https://i.pinimg.com/736x/69/d3/4f/69d34fab8f7d9d13a934296b29509630.jpg'); background-position: center top; background-repeat: repeat;">

    <table width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation">
        <tr>
            <td align="center" class="email-wrapper-cell">
                <div class="container">
                    <!-- Header Block with Translucent Background -->
                    <div class="header-block" style="background-color: rgba(245, 245, 220, 0.8); border-color: #eee;"> {# Beige Translucent #}
                        <header>
                            <h1>Good Morning {{ recipient_name }}!!!</h1>
                            <p class="subtitle">{{ datetime }}</p>
                            <p class="zen-quote">
                                <em>{{ zen_quote.quote }}</em>
                                <br>
                                <span style="display: block; text-align: right; font-size: 14px; color: var(--light-text); margin-top: 5px;">
                                    — {{ zen_quote.author }}
                                </span>
                            </p>
                        </header>
                    </div>

                    <!-- 1. Solar Schedule -->
                    <div class="section">
                        <h2><span class="icon">☀️</span> Solar Schedule</h2>
                        <div class="content-block">
                            <div class="solar-grid">
                                <div class="solar-item">
                                    <img src="https://media.makeameme.org/created/let-there-be-986084fdfc.jpg" alt="First Light">
                                    <strong>First Light</strong><span>{{ solar_schedule.first_light }}</span>
                                </div>
                                <div class="solar-item">
                                    <img src="https://images.pexels.com/photos/2371901/pexels-photo-2371901.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500" alt="Dawn">
                                    <strong>Dawn</strong><span>{{ solar_schedule.dawn }}</span>
                                </div>
                                <div class="solar-item">
                                    <img src="https://media.tenor.com/ctl4Dak8qGcAAAAe/teletubby-sun-sun.png" alt="Sunrise">
                                    <strong>Sunrise</strong><span>{{ solar_schedule.sunrise }}</span>
                                </div>
                                <div class="solar-item">
                                    <img src="https://i.pinimg.com/564x/2d/7f/7a/2d7f7abecc8422aecfc355dc32746573.jpg" alt="Noon">
                                    <strong>Noon</strong><span>{{ solar_schedule.solar_noon }}</span>
                                </div>
                                <div class="solar-item">
                                    <img src="https://i.ytimg.com/vi/DlUkRuqFZL4/maxresdefault.jpg" alt="Golden Hour">
                                    <strong>Golden Hour</strong><span>{{ solar_schedule.golden_hour }}</span>
                                </div>
                                <div class="solar-item">
                                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSw6ZTNqs4jEASx4dS7GhPf4lKTUNkXwOhEVw&s" alt="Sunset">
                                    <strong>Sunset</strong><span>{{ solar_schedule.sunset }}</span>
                                </div>
                                <div class="solar-item">
                                    <img src="https://preview.redd.it/the-difference-between-dusk-and-twilight-v0-3xona7wl7u7d1.jpeg?width=1000&format=pjpg&auto=webp&s=88a6fb3a4f5b5ad4f0460441d08a94a4b49b8244" alt="Dusk">
                                    <strong>Dusk</strong><span>{{ solar_schedule.dusk }}</span>
                                </div>
                                <div class="solar-item">
                                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/%D0%A1%D0%B2%D0%B5%D1%82_%D0%BE%D1%82_%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BD%D0%B8_-_panoramio.jpg/1200px-%D0%A1%D0%B2%D0%B5%D1%82_%D0%BE%D1%82_%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BD%D0%B8_-_panoramio.jpg" alt="Last Light">
                                    <strong>Last Light</strong><span>{{ solar_schedule.last_light }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Interesting Fact -->
                    <div class="section fact-block" style="background-color: rgba(241, 248, 233, 0.85); border-color: var(--accent-green);"> {# Light Green Translucent #}
                        <h2><span class="icon">💡</span> Interesting Fact</h2>
                        <p>{{ interesting_fact }}</p>
                    </div>

                    <!-- 3. Word of the Day -->
                    <div class="section wod-block" style="background-color: rgba(243, 229, 245, 0.85); border-color: #ab47bc;"> {# Light Purple Translucent #}
                        <h2><span class="icon">📖</span> Word of the Day</h2>
                        <span class="word">{{ wod.word }}</span>
                        <span class="pos">({{ wod.part_of_speech }})</span>
                        <p class="definition">{{ wod.definition }}</p>
                    </div>

                    <!-- 4. Recipe of the Day -->
                    <div class="section recipe-block" style="background-color: rgba(239, 235, 233, 0.85); border-color: var(--border-color);"> {# Light Brown-Gray Translucent #}
                        <h2><span class="icon">🔥</span> Recipe of the Day</h2>
                        <p class="recipe-name">{{ recipe.name }}</p>
                        {% if recipe.image_url %}
                        <img src="{{ recipe.image_url }}" alt="Image of {{ recipe.name }}">
                        {% endif %}
                        <div class="instructions">
                            <h3>Instructions:</h3>
                            <ol>
                                {% set instructions_list = recipe.instructions.splitlines() %}
                                {% for instruction in instructions_list %}
                                    {% if instruction.strip() %}<li>{{ instruction.strip() }}</li>{% endif %}
                                {% endfor %}
                            </ol>
                        </div>
                    </div>


                    <!-- 5. Restaurant Recommendations -->
                    {% if restaurants %}
                    <div class="section" style="background-color: rgba(245, 255, 250, 0.85); border-color: #a5d6a7;"> {# MintCream Translucent #}
                      <h2><span class="icon">🗺️</span> Places Serving "{{ recipe.name }}"</h2>
                          <table class="restaurant-table" border="0" cellpadding="0" cellspacing="0" width="100%">
                              <tbody>
                                  {% for restaurant in restaurants[:3] %}
                                  <tr>
                                      <td class="restaurant-photo-cell" width="130" style="width: 130px;"> {# Matched width attribute #}
                                          {# MODIFIED IMG SRC for Base64 #}
                                          {% if restaurant.photo_base64 %}
                                          <img src="data:image/jpeg;base64,{{ restaurant.photo_base64 }}" alt="Photo of {{ restaurant.name }}" class="restaurant-photo" width="120">
                                          {# Assuming JPEG, most common. Could try image/png if needed #}
                                          {% else %}
                                          <img src="https://via.placeholder.com/120x90.png?text=Image" alt="Placeholder" class="restaurant-photo" width="120">
                                          {% endif %}
                                      </td>
                                      <td class="restaurant-details">
                                          <h3>{{ restaurant.name }}</h3>
                                          <p class="address">{{ restaurant.address }}</p>
                                          <p class="rating">
                                              <span class="stars">
                                                  {% set rating_val = restaurant.rating|default(0)|round|int %}
                                                  {% for i in range(rating_val) %}⭐{% endfor %}{% for i in range(5-rating_val) %}<span style="opacity: 0.3;">⭐</span>{% endfor %}
                                              </span>
                                              ({{ restaurant.rating|round(1) if restaurant.rating else 'N/A' }}) - {{ restaurant.user_ratings_total or '?' }} Ratings
                                          </p>
                                          {% if restaurant.reviews %}
                                              <h4>Reviews:</h4>
                                              <ul>
                                              {% for review in restaurant.reviews %}
                                                  <li>
                                                      <div class="reviewer-line">
                                                          <span class="reviewer">{{ review.reviewer_name or 'Anonymous' }}:</span>
                                                          <span class="review-rating">
                                                              {% set review_rating_val = review.rating|default(0)|round|int %}
                                                              {% for i in range(review_rating_val) %}⭐{% endfor %}{% for i in range(5-review_rating_val) %}<span style="opacity: 0.3;">⭐</span>{% endfor %}
                                                          </span>
                                                      </div>
                                                      <span class="review-text">"{{ review.text[:200] }}{% if review.text|length > 200 %}..."{% endif %}"</span>
                                                  </li>
                                              {% endfor %}
                                              </ul>
                                          {% endif %}
                                      </td>
                                  </tr>
                                  {% endfor %}
                              </tbody>
                          </table>
                      {% else %}
                          <p>Could not find suitable restaurants for "{{ recipe.name }}" nearby.</p>
                      {% endif %}
                    </div>

                    <!-- 6. ArXiv Papers -->
                    {% if arxiv_papers %}
                    <div class="section" style="background-color: rgba(227, 242, 253, 0.85); border-color: var(--accent-steel);"> {# Light Blue Translucent #}
                        <h2><span class="icon">🔭</span> Latest Research: {{ arxiv_query | capitalize }}</h2>
                            {% for paper in arxiv_papers %}
                                <div class="arxiv-item">
                                    <div class="arxiv-title">{{ paper.title }}</div>
                                    <p><span class="arxiv-label">Abstract:</span> <span class="arxiv-abstract">{{ paper.abstract[:250] }}{% if paper.abstract|length > 250 %}...{% endif %}</span></p>
                                    <p class="arxiv-meta"><span class="arxiv-label">Submitted:</span> {{ paper.published }}</p>
                                    <p class="arxiv-link"><span class="arxiv-label">Link:</span> <a href="{{ paper.pdf_link }}" target="_blank">View PDF</a></p>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p>No new research papers found for "{{ arxiv_query }}".</p>
                        {% endif %}
                    </div>

                    <!-- 7. Horoscope -->
                    <div class="section horoscope-block" style="background-color: rgba(237, 231, 246, 0.85); border-color: #b39ddb;"> {# Light Purple Translucent #}
                        <h2><span class="icon">✨</span> Horoscope</h2>
                         <span class="sign">{{ horoscope.sign }}</span>
                         <p>{{ horoscope.prediction }}</p>
                         <span class="date">({{ horoscope.date }})</span>
                    </div>

                    <!-- 8. Cat of the Day -->
                    <div class="section cat-gif-block" style="background-color: rgba(241, 248, 233, 0.9); border-color: #c5e1a5;"> {# Lighter Green Translucent #}
                        <h2><span class="icon">🐾</span> Cat of the Day</h2>
                        <img src="{{ cat_gif }}" alt="Today's featured feline.">
                    </div>

                    <div class="footer">
                        <p>Have a great day!</p>
                    </div>
                </div><!-- /.container -->

            </td>
        </tr>
    </table><!-- /Full Width Wrapper Table -->

</body>
</html>